var urllib = require('urllib');var debug = require('debug')('mipush:util');var defaults = {  production: false,  timeout: 5000,  gzip: true};function request(method, url, data, callback) {  debug('request:', method, url, data);  var options = {    method: method,    data: data,    headers: {      Authorization: 'key=' + this.options.appSecret    },    dataType: 'json',    timeout: this.options.timeout || defaults.timeout,    gzip: this.options.gzip || defaults.gzip  };  urllib.request(url, options, function(err, data) {    debug('response:', err, data);    if (err) {      return callback(err);    }    // fail if data.code is 0    if (data.code !== 0) {      err = new Error(data.reason);      err.code = data.code;      return callback(err);    }    callback(null, data.data);  });}module.exports.post = function(url, data, callback) {  request.call(this, 'POST', url, data, callback);};module.exports.get = function(url, data, callback) {  request.call(this, 'GET', url, data, callback);};